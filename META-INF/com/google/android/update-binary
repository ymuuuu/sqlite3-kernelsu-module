#!/sbin/sh

#################
# Initialization
#################

umask 022

# Minimal ui_print fallback before util_functions load
ui_print() { echo "$1"; }

#########################
# Load util_functions.sh
#########################

OUTFD=$2
ZIPFILE=$3

mount /data 2>/dev/null

# When KernelSU/Sukisu calls this script it has already injected all util
# functions (install_module, ui_print, set_perm, abort …) into the shell
# environment — do NOT call ksud again or it recurses.
# We only need to source util_functions for Magisk where they live on disk.
if [ -f /data/adb/magisk/util_functions.sh ]; then
  . /data/adb/magisk/util_functions.sh
  [ "$MAGISK_VER_CODE" -lt 20400 ] && abort "Please install Magisk v20.4+"
fi

# install_module is available in both KernelSU (injected) and Magisk (sourced)
install_module
exit 0
