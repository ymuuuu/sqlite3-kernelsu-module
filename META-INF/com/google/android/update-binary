#!/sbin/sh

#################
# Initialization
#################

umask 022

# echo before loading util_functions
ui_print() { echo "$1"; }

require_supported_root() {
  ui_print "********************************************"
  ui_print " Install from Magisk v20.4+ or KernelSU app "
  ui_print "********************************************"
  exit 1
}

#########################
# Load util_functions.sh
#########################

OUTFD=$2
ZIPFILE=$3

mount /data 2>/dev/null

# KernelSU/Sukisu
if [ -f /data/adb/ksu/bin/ksud ]; then
  /data/adb/ksu/bin/ksud module install "$ZIPFILE"
  exit $?
fi

# Magisk
if [ -f /data/adb/magisk/util_functions.sh ]; then
  . /data/adb/magisk/util_functions.sh
  [ "$MAGISK_VER_CODE" -lt 20400 ] && require_supported_root
  install_module
  exit 0
fi

require_supported_root
